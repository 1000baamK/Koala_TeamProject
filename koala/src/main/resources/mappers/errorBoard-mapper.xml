<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="errorBoardMapper">
	
	<!-- 오류게시판  -->
	<resultMap type="errorBoard" id="errorBoardResultSet">
		<result column="REF_BNO" property="refBno"/>
		<result column="REF_SNO" property="refSno"/>
		<result column="SOLVED" property="solved"/>
		<result column="MODIFIED_CODE" property="modifiedCode"/>
		<result column="MODIFIED_INFO" property="modifiedInfo"/>
	</resultMap>

	<!-- 오류게시판 조회용 -->
	<resultMap type="errorSet" id="errorSetResultSet">
		<collection property="board" resultMap="boardMapper.boardResultSet"/>
		<collection property="errorBoard" resultMap="errorBoardResultSet"/>
		<collection property="createSetting" resultMap="adminMapper.createSettingResultSet"/>
	</resultMap>
	
	<!-- 총 게시글 수  -->
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		WHERE CATEGORY = 'E'
	</select>
	
	<!-- 게시글 전체 목록 조회 -->      <!-- 공지사항 여부가 Y인게 가장 위에 오도록 바꾸기 -->
	<select id="selectList" resultMap="errorSetResultSet">
		SELECT BOARD_NO,
		       SETTING_TITLE,
		       TITLE,
		       NICKNAME,
		       SOLVED,
		       B.CREATE_DATE,
		       COUNT
		FROM BOARD B
		JOIN MEMBER M ON (B.BOARD_WRITER = M.USER_NO)
		JOIN ERROR_BOARD E ON (B.BOARD_NO = E.REF_BNO)
		JOIN CREATE_SETTING C ON(E.REF_SNO = C.SETTING_NO)
		WHERE B.STATUS = 'Y'
		AND B.CATEGORY = 'E'
		ORDER BY BOARD_NO DESC
	</select>
	
	<!-- 게시글 작성 시 수정폼 생성 - 코드 -->
	<select id="createCodeForm" resultMap="adminMapper.createSettingResultSet">
		SELECT SETTING_CODE
		FROM CREATE_SETTING
		WHERE SETTING_TITLE = #{settingTitle}
		AND SETTING_VERSION = #{settingVersion}
		AND STATUS IN ('Y','N')
	</select>

	<!-- 게시글 작성 시 수정폼 생성 - 설명서 -->
	<select id="createInfoForm" resultMap="errorSetResultSet">
		SELECT SETTING_INFO
		FROM CREATE_SETTING
		WHERE SETTING_TITLE = #{settingTitle}
		AND SETTING_VERSION = #{settingVersion}
		AND STATUS IN ('Y','N')
	</select>
	
</mapper>